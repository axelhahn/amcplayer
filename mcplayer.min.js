/* https://www.axel-hahn.de/ */
var mcPlayer=function(){this.cfg={about:{version:"0.28",label:"AMC Player - v0.28",description:"<strong>A</strong>xels <strong>M</strong>ulti <strong>C</strong>hannel <strong>Player</strong>.<br><br>This is a webbased HTML5 player.<br>It's focus is the handling of media in stereo and surround for a title.",labeldownload:"Download:<br>",download:"http://sourceforge.net/projects/amcplayer/files/latest/download",labellicense:"License: ",license:"GPL 3.0",labelurl:"Project url:<br>",url:"https://github.com/axelhahn/amcplayer/",labeldocurl:"Documentation:<br>",docurl:"https://www.axel-hahn.de/docs/amcplayer/index.htm"},links:{play:{title:"play"}},aPlayer:{buttons:{play:{sticky:true,title:"Play"},pause:{sticky:true,title:"Pause"},stop:{sticky:true,title:"Stop"},backward:{sticky:false,title:"Back"},forward:{sticky:false,title:"Forward"},jumpprev:{sticky:false,title:"Previous title"},jumpnext:{sticky:false,title:"Next title"},audiochannels:{title:"switch between stereo/ surround",noswitch:"stereo/ surround switch was deactivated (Opera, Firefox)"},volmute:{visible:true,title:"Mute"},volfull:{visible:true,title:"Max. volume"},about:{visible:true,title:"about ...",box:"mcpabout"},playlist:{visible:true,title:"Toggle playlist",box:"mcpplaylist"},repeat:{visible:true,title:"Repeat"},shuffle:{visible:true,title:"Shuffle"},download:{visible:true,title:"Toggle download list",box:"mcpdownloads"},maximize:{label:"Player",sticky:false,title:"Show player"},minimize:{label:"",sticky:false,title:"Minimize"}},bars:{volume:{visible:true,title:"Set volume"},progress:{visible:true,title:"Set position"}},playlist:{title:"Playlist"},download:{title:"Download audio files",noentry:"Select an audio first to show its downloads."}},settings:{autoopen:1,movable:1,repeatlist:1,shuffle:0,volume:0.9}};this.oAudio=false;this.sCurrentChannel=false;this.iMaxVol=1;this.iCurrentTime=false;this.bIsFading=false;this.iVolInc=0.02;this.iTimer=20;this.iHudTimer=5;this.iRemoveTimer=2;this.aPL=[];this.iCurrentSong=-1;this.aPlayorderList=[];this.iPlaylistId=-1;this.name=false;this.playlink="[title]";this.canPlaySurround=function(){var b=true;if(navigator.userAgent.indexOf("Presto/")>=0){b=false}this.bCanSurround=b;return b};this._scanAudios=function(){var e=document.getElementsByTagName("AUDIO");var h=new Array();var l=false;var k=false;var d=false;var c=false;for(var g=0;g<e.length;g++){e[g].style.display="none";d={title:e[g].dataset.title?e[g].dataset.title:e[g].title?e[g].title:"audio #"+(g+1),artist:e[g].dataset.artist?e[g].dataset.artist:false,album:e[g].dataset.album?e[g].dataset.album:false,year:e[g].dataset.year?e[g].dataset.year:false,image:e[g].dataset.image?e[g].dataset.image:false,genre:e[g].dataset.genre?e[g].dataset.genre:false,bpm:e[g].dataset.bpm?e[g].dataset.bpm:false,url:e[g].dataset.url?e[g].dataset.url:false,sources:{}};for(var f=0;f<e[g].children.length;f++){c=e[g].children[f];if(c.tagName==="SOURCE"){k="any";if(c.title){k=c.title}l={src:c.src,type:c.type};if(!d.sources[k]){dummy=d.sources[k]=new Array()}dummy=d.sources[k].push(l)}}this.addAudio(d);var b=document.createElement("A");b.href="#";b.title=this.cfg.links.play.title+": "+d.title;b.innerHTML=this.playlink.replace("[title]","");b.setAttribute("onclick",this.name+".setSong("+g+"); /* "+this.name+".maximize(); */ return false;");b.setAttribute("class","songbtn icon-play");b.setAttribute("id","mcpaudioPlay"+g);e[g].parentNode.appendChild(b)}return h};this.addAudio=function(b){if(!b.sources){return false}if(!b.title){b.title="audio "+(this.aPL.length+1)}this.aPL.push(b);this._generatePlayorder()};this._genPlayer=function(){var c="";var e=new Array("play","pause","stop","backward","forward");if(this.aPL.length>1){e.push("jumpprev","jumpnext")}c+='<div id="mcpplayerbtndiv">';for(var b=0;b<e.length;b++){c+='<a href="#" id="mcp'+e[b]+'" onclick="'+this.name+".playeraction('"+e[b]+'\'); return false;" title="'+this.cfg.aPlayer.buttons[e[b]].title+'"></a>'}c+='</div><span id="mcptime"><span id="mcptimeplayed">-:--</span>/ <span id="mcptimetotal">-:--</span></span><div id="mcpprogressdiv"'+(this.cfg.aPlayer.bars.progress.visible?"":'style="display: none"')+'><canvas id="mcpprogresscanvas" title="'+this.cfg.aPlayer.bars.progress.title+'"></canvas><div id="mcpprogressbar"></div></div><div id="mcpvolumediv" title="volume"><a href="#" id="mcpvolmute" onclick="'+this.name+'.setVolume(0); return false;" '+(this.cfg.aPlayer.buttons.volmute.visible?"":'style="display: none" ')+'title="'+this.cfg.aPlayer.buttons.volmute.title+'"></a><canvas id="mcpvolumecanvas" '+(this.cfg.aPlayer.bars.volume.visible?"":'style="display: none" ')+'title="'+this.cfg.aPlayer.bars.volume.title+'"></canvas><a href="#" id="mcpvolfull" onclick="'+this.name+'.setVolume(1); return false;" '+(this.cfg.aPlayer.buttons.volfull.visible?"":'style="display: none" ')+'title="'+this.cfg.aPlayer.buttons.volfull.title+'"></a></div><div id="mcpchannels"></div><div id="mcpoptions">';c+='<a href="#" onclick="'+this.name+'.toggleRepeat(); return false;" id="mcpoptrepeat" '+(this.isRepeatlist()?'class="active" ':"")+'title="'+this.cfg.aPlayer.buttons.repeat.title+'"></a><a href="#" onclick="'+this.name+'.toggleShuffle(); return false;" id="mcpoptshuffle" '+(this.cfg.settings.shuffle?'class="active" ':"")+'title="'+this.cfg.aPlayer.buttons.shuffle.title+'"></a>';var d=["download","playlist","about"];for(var b=0;b<d.length;b++){idLink="mcpopt"+d[b];c+='<a href="#" onclick="'+this.name+".toggleBoxAndButton('"+d[b]+'\'); return false;" id="mcpopt'+d[b]+'" '+(this.cfg.aPlayer.buttons[d[b]].visible?"":'style="display: none" ')+' title="'+this.cfg.aPlayer.buttons[d[b]].title+'"></a>'}c+="</div>";return c};this._genAboutbox=function(){return'<div class="mcpbox">'+this.cfg.about.label+'<span class="mcpsystembutton"><a href="#" class="icon-down-open-1" onclick="'+this.name+".toggleBoxAndButton('about', 'minimize'); return false;\" title=\""+this.cfg.aPlayer.buttons.minimize.title+'">'+this.cfg.aPlayer.buttons.minimize.label+"</a></span></div><div><p>"+this.cfg.about.description+"</p><p>"+this.cfg.about.labellicense+""+this.cfg.about.license+"</p><p>"+this.cfg.about.labelurl+'<a href="'+this.cfg.about.url+'" target="_blank">'+this.cfg.about.url+"</a></p><p>"+this.cfg.about.labeldownload+'<a href="'+this.cfg.about.download+'" target="_blank">'+this.cfg.about.download+"</a></p><p>"+this.cfg.about.labeldocurl+'<a href="'+this.cfg.about.docurl+'" target="_blank">'+this.cfg.about.docurl+"</a></p></div>"};this._genPlaylist=function(){var c='<div class="mcpbox">'+this.cfg.aPlayer.playlist.title+'<span class="mcpsystembutton"><a href="#" class="icon-down-open-1" onclick="'+this.name+".toggleBoxAndButton('playlist', 'minimize'); return false;\" title=\""+this.cfg.aPlayer.buttons.minimize.title+'">'+this.cfg.aPlayer.buttons.minimize.label+"</a></span></div>";if(this.aPL.length>0){c+="<ul>";for(var b=0;b<this.aPL.length;b++){c+="<li"+(this.iCurrentSong===b?' class="active"':"")+'><a href="#" onclick="'+this.name+".setSong("+b+'); return false;">'+(this.aPL[b]["title"]?this.aPL[b]["title"]:"Audio #"+(b+1))+"</a></li>"}c+="</ul>"}return c};this._genDownloads=function(){var d="";if(this.aPL.length>0){d+='<div class="mcpbox">'+this.cfg.aPlayer.download.title+'<span class="mcpsystembutton"><a href="#" class="icon-down-open-1" onclick="'+this.name+".toggleBoxAndButton('download', 'minimize'); return false;\" title=\""+this.cfg.aPlayer.buttons.minimize.title+'">'+this.cfg.aPlayer.buttons.minimize.label+"</a></span></div><ul>";if(this.iCurrentSong===-1){d+="<li>"+this.cfg.aPlayer.download.noentry+"</li>"}else{for(var c=0;c<this.aPL.length;c++){sSong=this.aPL[c]["title"];if(!sSong){sSong="Audio #"+(c+1)}if(this.iCurrentSong===-1||this.iCurrentSong==c){d+="<li "+(this.iCurrentSong==c?' class="active"':"")+">"+sSong+"<ul>";for(var b in this.aPL[c]["sources"]){d+="<li>"+b+": ";for(j=0;j<this.aPL[c]["sources"][b].length;j++){sSrc=this.aPL[c]["sources"][b][j]["src"];sExt=this.aPL[c]["sources"][b][j]["type"].replace("audio/","");if(!sExt){sExt=this.aPL[c]["sources"][b][j]["src"].replace(/^.*\/|\.[^.]*$/g,"")}d+=(j>0?" | ":"")+'<a href="'+this.aPL[c]["sources"][b][j]["src"]+'" title="'+sSong+" ("+b+"; "+sExt+")\n"+this.aPL[c]["sources"][b][j]["src"]+'">'+sExt+"</a>"}d+="</li>"}d+="</ul></li>"}}}d+="</ul>"}return d};this._generatePlaylist=function(){this._scanAudios();this._generatePlayorder()};this._randomSort=function(d,c){return(parseInt(Math.random()*10)%2)};this._generatePlayorder=function(){this.aPlayorderList=[];if(this.aPL.length){for(var b=0;b<this.aPL.length;b++){this.aPlayorderList[b]=b}if(this.isShuffled()){if(this.iCurrentSong>=0){this.aPlayorderList.splice(this.iCurrentSong,1)}this.aPlayorderList.sort(this._randomSort);if(this.iCurrentSong>=0){this.aPlayorderList.unshift(this.iCurrentSong)}}this._findPlaylistId()}};this._findPlaylistId=function(){this.iPlaylistId=false;if(this.iCurrentSong>=0){for(var b=0;b<this.aPlayorderList.length;b++){if(this.aPlayorderList[b]===this.iCurrentSong){this.iPlaylistId=b}}}return this.iPlaylistId};this._initHtml=function(){var b=' style="top: '+((document.documentElement.clientHeight+100)+"px")+';"';this.oDivDownloads=document.getElementById("mcpdownloads");if(!this.oDivDownloads){document.getElementsByTagName("BODY")[0].innerHTML+='<div id="mcpdownloads" class="draggable saveposition"'+b+"></div>";this.oDivDownloads=document.getElementById("mcpdownloads")}this.oDivDownloads.innerHTML=this._genDownloads();this.oDivPlaylist=document.getElementById("mcpplaylist");if(!this.oDivPlaylist){document.getElementsByTagName("BODY")[0].innerHTML+='<div id="mcpplaylist" class="draggable saveposition"'+b+"></div>";this.oDivPlaylist=document.getElementById("mcpplaylist")}this.oDivPlaylist.innerHTML=this._genPlaylist();this.oDivPlayerwrapper=document.getElementById("mcpwrapper");if(!this.oDivPlayerwrapper){document.getElementsByTagName("BODY")[0].innerHTML+='<div id="mcpwrapper"'+(this.cfg.settings.movable?'class="draggable saveposition"':"")+"></div>";this.oDivPlayerwrapper=document.getElementById("mcpwrapper")}this.oDivHeader=document.getElementById("mcpheader");if(!this.oDivHeader){this.oDivPlayerwrapper.innerHTML+='<div id="mcpheader" class="mcpbox">'+this.cfg.about.label+' <span id="mcptitle"></span><span class="mcpsystembutton"><a href="#" class="icon-down-open-1" onclick="'+this.name+'.minimize(); return false" title="'+this.cfg.aPlayer.buttons.minimize.title+'">'+this.cfg.aPlayer.buttons.minimize.label+"</a></span></div>"}if(!this.oDivAudios){this.oDivPlayerwrapper.innerHTML+='<div id="mcpplayeraudios"></div>';this.oDivAudios=document.getElementById("mcpplayeraudios")}this.oDivPlayer=document.getElementById("mcplayer");if(!this.oDivPlayer){this.oDivPlayerwrapper.innerHTML+='<div id="mcplayer"></div>';this.oDivPlayer=document.getElementById("mcplayer");this.oDivPlayer.innerHTML=this._genPlayer()}this.oDivFooter=document.getElementById("mcpfooter");if(!this.oDivFooter){this.oDivPlayerwrapper.innerHTML+='<div id="mcpfooter">'+this.about+"</div>"}this.oAPlayermaximize=document.getElementById("mcpmaximize");if(!this.oAPlayermaximize){document.getElementsByTagName("BODY")[0].innerHTML+='<a href="#" id="mcpmaximize" class="mcpsystembutton hidebutton" onclick="'+this.name+'.maximize(); return false" title="'+this.cfg.aPlayer.buttons.maximize.title+'">'+this.cfg.aPlayer.buttons.maximize.label+"</a>";this.oAPlayermaximize=document.getElementById("mcpmaximize")}document.getElementsByTagName("BODY")[0].innerHTML+='<div id="mcpabout" class="draggable saveposition"'+b+">"+this._genAboutbox()+"</div>";this.oDivPlayerhud=document.getElementById("mcphud");if(!this.oDivPlayerhud){document.getElementsByTagName("BODY")[0].innerHTML+='<div id="mcphud"></div>';this.oDivPlayerhud=document.getElementById("mcphud")}};this.minimize=function(){o=document.getElementById("mcpwrapper");o.style.top=(document.documentElement.clientHeight+100)+"px";this.minimizeBox("about");this.minimizeBox("download");this.minimizeBox("playlist");o=document.getElementById("mcpmaximize");o.className=""};this.makeMainwindowMovable=function(b){this.cfg.settings.movable=b;o=document.getElementById("mcpwrapper");if(this.cfg.settings.movable){o.className="draggable saveposition";if(typeof addi!=="undefined"){addi.initDiv(o)}}else{o.className="";if(typeof addi!=="undefined"){addi.resetDiv(o)}this.maximize();o.setAttribute("style","")}};this.maximize=function(){o=document.getElementById("mcpwrapper");o.setAttribute("style","");if(this.cfg.settings.movable&&typeof addi!=="undefined"){addi.load(document.getElementById("mcpwrapper"))}document.getElementById("mcpmaximize").className="hidebutton"};this._showInfo=function(b){if(!this.iHudTimer){return false}var c=document.getElementById("mcphud");this.iRemoveTimer=this.iHudTimer*1000;c.className="active";c.innerHTML=b;this._decHudTimer();return true};this._hideInfo=function(){var b=document.getElementById("mcphud");b.className="";return true};this._decHudTimer=function(){this.iRemoveTimer=this.iRemoveTimer-100;if(this.iRemoveTimer>0){window.setTimeout(this.name+"._decHudTimer()",100)}else{this._hideInfo();this.iRemoveTimer=false}};this._togglehelperGetDiv=function(b){return(this.cfg.aPlayer.buttons[b]&&this.cfg.aPlayer.buttons[b].box)?document.getElementById(this.cfg.aPlayer.buttons[b].box):false};this.toggleBoxAndButton=function(d,c){var b=this._togglehelperGetDiv(d);var e=document.getElementById("mcpopt"+d);if(!c){c=(e.className.indexOf("active")<0?"maximize":"minimize")}if(c==="minimize"){if(b){b.style.top=(document.documentElement.clientHeight+10)+"px";b.style.opacity=0.1}if(e){e.className=""}}else{if(c==="maximize"){if(b){b.setAttribute("style","");b.style.opacity=1;if(typeof addi!=="undefined"){addi.load(b)}}if(e){e.className="active"}}}return true};this.isVisibleBox=function(b){var c=document.getElementById("mcpopt"+b);return !!c.className};this.isVisibleBoxAbout=function(){return this.isVisibleBox("about")};this.isVisibleBoxDownload=function(){return this.isVisibleBox("download")};this.isVisibleBoxPlaylist=function(){return this.isVisibleBox("playlist")};this.toggleRepeat=function(){if(this.isRepeatlist()){return this.disableRepeat()}else{return this.enableRepeat()}};this.enableRepeat=function(){this.cfg.settings.repeatlist=true;this.toggleBoxAndButton("repeat","maximize")};this.disableRepeat=function(){this.cfg.settings.repeatlist=false;this.toggleBoxAndButton("repeat","minimize")};this.toggleShuffle=function(){if(this.isShuffled()){return this.disableShuffle()}else{return this.enableShuffle()}};this.enableShuffle=function(){this.cfg.settings.shuffle=true;this._generatePlayorder();this.toggleBoxAndButton("shuffle","maximize")};this.disableShuffle=function(){this.cfg.settings.shuffle=false;this._generatePlayorder();this.toggleBoxAndButton("shuffle","minimize")};this.minimizeBox=function(b){return this.toggleBoxAndButton(b,"minimize")};this.maximizeBox=function(b){return this.toggleBoxAndButton(b,"maximize")};this.playeraction=function(b){if(!this.oAudio){if(b==="play"){this.setSong(this.aPlayorderList[0])}else{return false}}switch(b){case"play":this.oAudio.play();break;case"pause":this.oAudio.pause();break;case"stop":this.oAudio.pause();try{this.oAudio.currentTime=0}catch(g){}break;case"forward":this.oAudio.currentTime+=10;break;case"backward":this.oAudio.currentTime-=10;break;case"jumpprev":this.setPreviousSong();break;case"jumpnext":this.setNextSong();break;default:alert("playeraction not implemented yet: ["+b+"]")}if(this.cfg.aPlayer.buttons[b].sticky){var c=document.getElementById("mcpplayerbtndiv");var f=c.getElementsByTagName("A");for(var d=0;d<f.length;d++){f[d].className=""}document.getElementById("mcp"+b).className="active"}};this.setAudioPosition=function(b){if(!this.sCurrentChannel||this.oAudio.duration<b){return false}return this.oAudio.currentTime=b};this.setPreviousSong=function(){if(!this.aPlayorderList||!this.aPlayorderList.length){return false}if(this.iPlaylistId>0){return this.setSong(this.aPlayorderList[this.iPlaylistId-1])}return this.setSong(this.aPlayorderList[this.aPlayorderList.length-1])};this.setNextSong=function(){if(!this.aPL||!this.aPL.length){return false}if(this.iPlaylistId<(this.aPlayorderList.length-1)){return this.setSong(this.aPlayorderList[this.iPlaylistId+1])}else{this._generatePlayorder();if(this.isRepeatlist()){this.setSong(this.aPlayorderList[(this.isShuffled()?1:0)])}}};this.setSong=function(c){if(!this.aPL[c]){return false}if(this.bIsFading){return false}var q="";var p="";var d=false;var n=false;var b=false;var m=0;if(this.oAudio){this.getVolume();this.oAudio.pause();try{this.oAudio.currentTime=0}catch(l){}this.oAudio=false}this.oDivAudios.innerHTML="";var h="";for(var k in this.aPL[c]["sources"]){if(this.aPL[c]["sources"][k].length){if(!d){d=k}if(n!==k){m++;p+="<li class";p+=">";if(this.bCanSurround){p+='<a href="#" onclick="'+this.name+".setChannel('"+k+'\'); return false;" title="'+this.cfg.aPlayer.buttons.audiochannels.title+": "+k+'">'+k+"</a>"}else{p+='<a href="#" onclick="return false;" title="'+this.cfg.aPlayer.buttons.audiochannels.noswitch+'">'+k+"</a>"}p+="</li>";n=k;if(k===this.sCurrentChannel){b=true}}q+='<audio id="mcp'+k+'" '+h+" >";for(g=0;g<this.aPL[c]["sources"][k].length;g++){source=this.aPL[c]["sources"][k][g];sourcesrc=String(source.src);if(sourcesrc.indexOf("?")<0){sourcesrc+="?"}q+='<source src="'+sourcesrc+'" type="'+source.type+'">'}q+="</audio>"}}if(m===1){p="<li>"+k+"</li>"}document.getElementById("mcpplayeraudios").innerHTML=q;if(p){p="<ul>"+p+"</ul>"}document.getElementById("mcpchannels").innerHTML=p;this.iCurrentSong=c;this._findPlaylistId();document.getElementById("mcpplaylist").innerHTML=this._genPlaylist();document.getElementById("mcpdownloads").innerHTML=this._genDownloads();var f=document.getElementsByTagName("A");for(var g=0;g<f.length;g++){oLink=f[g];if(oLink.className==="songbtn icon-play songbtnactive"){oLink.className="songbtn icon-play"}}o=document.getElementById("mcpaudioPlay"+c).className+=" songbtnactive";this.iCurrentTime=false;if(b){d=this.sCurrentChannel}this.sCurrentChannel=false;this.setChannel(d);this.playeraction("play",true);document.getElementById("mcptitle").innerHTML=this.aPL[c]["title"];this._showInfo((c+1)+"/ "+this.aPL.length+"<br>&laquo;"+this.aPL[c]["title"]+"&raquo;");if(this.cfg.settings.autoopen){this.maximize()}return true};this.setChannel=function(c){var b=document.getElementById("mcpchannels");var f=b.getElementsByTagName("LI");if(f.length){for(var d=0;d<f.length;d++){oALI=f[d].getElementsByTagName("A");if(oALI&&oALI.length>0){oALI[0].className="";if(oALI[0].innerHTML&&oALI[0].innerHTML===c){var e=oALI[0].parentNode;oALI[0].className="active"}}f[d].className=""}}if(e){e.className="active"}if(this.sCurrentChannel===c){return false}if(this.bIsFading){return false}if(this.oAudio){this.iCurrentTime=this.oAudio.currentTime;this.getVolume();this._fadeOut(this.sCurrentChannel)}this.oAudio=false;if(c){oAudioTmp=document.getElementById("mcp"+c);this.oAudio=oAudioTmp;if(this.oAudio){this._wait4Audio(this.oAudio,this.iCurrentTime);this.oAudio.volume=this.cfg.settings.volume;oAudioTmp.addEventListener("timeupdate",function(){if(!oAudioTmp.currentTime){document.getElementById("mcptimeplayed").innerHTML="-:--";document.getElementById("mcptimetotal").innerHTML="-:--";return false}var n=parseInt(oAudioTmp.currentTime%60);var g=parseInt((oAudioTmp.currentTime/60)%60);if(n<10){n="0"+n}var l=parseInt(oAudioTmp.duration%60);var i=parseInt((oAudioTmp.duration/60)%60);if(l<10){l="0"+l}document.getElementById("mcptimeplayed").innerHTML=g+":"+n;document.getElementById("mcptimetotal").innerHTML=i+":"+l;var k=document.getElementById("mcpprogresscanvas");if(k.getContext){var h=k.getContext("2d");h.clearRect(0,0,k.width,k.height);var q=0.05+oAudioTmp.currentTime/oAudioTmp.duration/10*1;h.fillStyle="rgba(0,0,0, "+q+")";var p=Math.round((oAudioTmp.currentTime/oAudioTmp.duration)*(k.width));if(p>0){h.fillRect(0,0,p,k.height);h.strokeStyle="rgba(0,0,0,0.3)";h.lineWidth=1;h.beginPath();h.moveTo(p,0);h.lineTo(p,k.height);h.stroke()}}},false);document.getElementById("mcpprogresscanvas").addEventListener("click",function(i){var g=new Number();var l=document.getElementById("mcpwrapper");var k=document.getElementById("mcpprogressdiv");var h=document.getElementById("mcpprogresscanvas");if(i.x!==undefined&&i.y!==undefined){g=i.x}else{g=i.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}g-=h.offsetLeft+l.offsetLeft+k.offsetLeft;if(oAudioTmp&&oAudioTmp.currentTime){oAudioTmp.currentTime=oAudioTmp.duration*(g/h.clientWidth)}},true);oAudioTmp.addEventListener("volumechange",function(){var h=document.getElementById("mcpvolumecanvas");if(h.getContext){var i=h.getContext("2d");i.clearRect(0,0,h.width,h.height);var k=0.05+oAudioTmp.volume/10*1;i.fillStyle="rgba(0,0,0, "+k+")";var g=Math.round(oAudioTmp.volume*h.width);if(g>0){i.fillRect(0,0,g,h.height);i.strokeStyle="rgba(0,0,0,0.3)";i.lineWidth=3;i.beginPath();i.moveTo((g),0);i.lineTo(g,h.height);i.stroke()}}},false);document.getElementById("mcpvolumecanvas").addEventListener("click",function(k){var g=new Number();var l=document.getElementById("mcpwrapper");var h=document.getElementById("mcpvolumecanvas");if(k.x!==undefined&&k.y!==undefined){g=k.x}else{g=k.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}g-=h.offsetLeft+l.offsetLeft;try{localStorage.setItem("amcp.volume",g/h.clientWidth);oAudioTmp.volume=(g/h.clientWidth)}catch(i){console.error("Error:"+i)}},true);oAudioTmp.addEventListener("ended",function(){document.getElementById("mcpjumpnext").click()},false)}}this.sCurrentChannel=c;localStorage.setItem("amcp.channels",this.sCurrentChannel);return true};this.setVolume=function(b){this.cfg.settings.volume=b;localStorage.setItem("amcp.volume",this.cfg.settings.volume);if(this.oAudio){this.oAudio.volume=b;return true}return false};this._wait4Audio=function(c,b){c.volume=0.001;c.play();if(b){c.currentTime=b}return true};this._fade=function(c,b){this.bIsFading=true;o=document.getElementById("mcp"+b);if(!o){return false}iVol=o.volume;iInc=(c<iVol?-this.iVolInc:this.iVolInc);iVol+=iInc;if((c===0&&iVol>0)||(c>0&&iVol<c)){o.volume=iVol;window.setTimeout(this.name+"._fade("+c+", '"+b+"')",this.iTimer)}else{this.bIsFading=false;o.volume=c;if(iVol<=0){o.pause()}}return true};this._fadeOut=function(b){this._fade(0,b)};this.getAudioChannels=function(){return this.sCurrentChannel};this.getAllAudioChannels=function(){var b=this.getSong();if(!b){return false}var c=[];for(var d in b.sources){c.push(d)}return c};this.getAudioDuration=function(){if(!this.sCurrentChannel){return false}return this.oAudio.duration};this.getAudioPosition=function(){if(!this.sCurrentChannel){return false}return this.oAudio.currentTime};this.getAudioSrc=function(){if(!this.sCurrentChannel){return false}return this.oAudio.currentSrc};this.getVolume=function(){if(this.oAudio){this.cfg.settings.volume=this.oAudio.volume;return this.cfg.settings.volume}return false};this.getPlaylist=function(){return(!this.aPL||!this.aPL.length)?false:this.aPL};this.getPlaylistCount=function(){return(this.aPL?this.aPL.length:false)};this.getPlayorder=function(){return this.aPlayorderList};this.getSong=function(){if(!this.aPL||!this.aPL.length){return false}return this.aPL[this.iCurrentSong]};this.getSongId=function(){return this.iCurrentSong};this._getSongItem=function(c){console.log("_getSongItem - "+c);var b=this.getSong();return b?b[c]:false};this.getSongTitle=function(){return this._getSongItem("title")};this.getSongArtist=function(){return this._getSongItem("artist")};this.getSongAlbum=function(){return this._getSongItem("album")};this.getSongYear=function(){return this._getSongItem("year")};this.getSongImage=function(){return this._getSongItem("image")};this.getSongGenre=function(){return this._getSongItem("genre")};this.getSongBpm=function(){return this._getSongItem("bpm")};this.getSongUrl=function(){return this._getSongItem("url")};this.getPlaylistId=function(){return this.iPlaylistId};this.isMuted=function(){return(this.oAudio&&(this.oAudio.muted||!this.oAudio.volume))};this.isPaused=function(){return(this.oAudio&&this.oAudio.paused&&this.oAudio.currentTime!==0)};this.isPlaying=function(){return(this.oAudio&&!this.oAudio.paused)};this.isRepeatlist=function(){return(this.cfg.settings.repeatlist?!!this.cfg.settings.repeatlist:false)};this.isShuffled=function(){return(this.cfg.settings.shuffle?this.cfg.settings.shuffle:false)};this.isStopped=function(){return(!this.oAudio||this.oAudio.currentTime===0)};this._getName=function(){for(var b in this.global){if(this.global[b]===this){return this._setName(b)}}};this._setName=function(b){this.name=b;return this.name};this.init=function(){this._getName();this._generatePlaylist();this._initHtml();if(typeof addi!=="undefined"){addi.init()}this.minimizeBox("about");this.minimizeBox("download");this.minimizeBox("playlist");return true};if(arguments[0]){this.cfg=realMerge(this.cfg,arguments[0])}this.canPlaySurround();try{this.sCurrentChannel=localStorage.getItem("amcp.channels")?localStorage.getItem("amcp.channels"):false;this.cfg.settings.volume=localStorage.getItem("amcp.volume")?localStorage.getItem("amcp.volume"):1}catch(a){}return true};mcPlayer.prototype.global=this;var realMerge=function(c,b){for(var a in b){if(typeof c[a]!=="object"){c[a]=b[a]}else{if(typeof b[a]==="object"){c[a]=realMerge(c[a],b[a])}}}return c};